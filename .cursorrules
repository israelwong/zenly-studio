# ZENPro - Cursor Rules v2.1 (Haiku Optimizado)

## üéØ PROYECTO CORE

**Producto:** ZEN - Plataforma modular SaaS para estudios fotogr√°ficos  
**Stack:** Next.js 15 + TypeScript 5 + React 19 + Prisma + Supabase + Tailwind 4  
**Arquitectura:** Multi-tenant con sistema de m√≥dulos activables

---

## ü§ñ MODO HAIKU - REGLAS DE EFICIENCIA

**PRINCIPIO FUNDAMENTAL: M√°xima utilidad, m√≠nimos tokens**

### Formato de Respuestas Haiku

**‚úÖ CORRECTO:**

```typescript
// C√≥digo refactorizado
[c√≥digo limpio y completo]
// Cambios: extraje validaci√≥n, agregu√© tipos
```

**‚ùå PROHIBIDO:**

```
Voy a analizar tu c√≥digo...
[explicaci√≥n previa]
[c√≥digo]
Resumen de cambios:
- Punto 1
- Punto 2
Resumen ejecutivo: [repetir lo mismo]
Mensaje de commit sugerido: [otro resumen]
¬øNecesitas algo m√°s?
```

### Reglas por Tipo de Tarea

**Refactoring:**

- Solo c√≥digo + 1 l√≠nea de cambios clave
- NO res√∫menes antes/despu√©s
- NO commits autom√°ticos

**Server Actions:**

```typescript
// ‚úÖ Entregar directo
export async function crearLead(data: unknown) {
  const validated = LeadSchema.parse(data);
  return await prisma.platform_leads.create({ data: validated });
}
// Validaci√≥n + create. Listo.

// ‚ùå NO hacer
("Primero valido con Zod, luego creo en DB, finalmente revalido...");
```

**Componentes ZEN:**

- C√≥digo completo funcional
- NO explicar props obvias
- Comentarios solo para l√≥gica compleja

**Debugging:**

- Ir directo al fix
- Explicar SOLO si no es obvio
- NO narrar proceso de an√°lisis

**An√°lisis/Review:**

- Bullets directos: `Problema ‚Üí Fix`
- NO contexto repetido
- NO resumen ejecutivo

### Excepciones (S√ç dar detalle)

- Arquitectura de m√≥dulos nuevos
- Trade-offs importantes
- Usuario pregunta "¬øpor qu√©?"
- Cambios que rompen compatibilidad

---

## üß© ARQUITECTURA MODULAR

**M√≥dulos Core MVP:**

- ZEN Manager (incluido en todos los planes)
- ZEN Magic (IA - planes Pro+)
- ZEN Marketing (CRM - planes Pro+)

**M√≥dulos Add-ons (Fase 2+):**

- ZEN Payment (+$10 USD/mes)
- ZEN Conversations (+$15 USD/mes)
- ZEN Cloud (+$15 USD/mes)
- ZEN Invitation (+$12 USD/mes)

**Verificaci√≥n de M√≥dulos:**

```typescript
const hasModule = await checkStudioModule(studioId, "payment");
```

---

## üèóÔ∏è ESTRUCTURA DE DIRECTORIOS

```
src/
‚îú‚îÄ‚îÄ app/(authenticated)/
‚îÇ   ‚îú‚îÄ‚îÄ admin/              # Super Admin
‚îÇ   ‚îú‚îÄ‚îÄ agente/             # Agentes CRM
‚îÇ   ‚îî‚îÄ‚îÄ studio/[slug]/      # Suscriptores
‚îÇ       ‚îú‚îÄ‚îÄ manager/        # ZEN Manager
‚îÇ       ‚îú‚îÄ‚îÄ magic/          # ZEN Magic
‚îÇ       ‚îú‚îÄ‚îÄ marketing/      # ZEN Marketing
‚îÇ       ‚îî‚îÄ‚îÄ payment/        # ZEN Payment (add-on)
‚îú‚îÄ‚îÄ components/ui/
‚îÇ   ‚îú‚îÄ‚îÄ zen/               # ZEN Design System (USAR PRIMERO)
‚îÇ   ‚îî‚îÄ‚îÄ shadcn/            # Base components (fallback)
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ actions/           # Server Actions por m√≥dulo
‚îÇ   ‚îî‚îÄ‚îÄ modules/           # L√≥gica de gesti√≥n de m√≥dulos
‚îî‚îÄ‚îÄ types/                 # TypeScript types
```

---

## üé® DISE√ëO ZEN (PRIORIDAD #1)

**Imports OBLIGATORIOS:**

```typescript
// ‚úÖ SIEMPRE ZEN primero
import { ZenButton, ZenInput, ZenCard } from "@/components/ui/zen";

// ‚ùå PROHIBIDO - Rutas directas
import { ZenButton } from "@/components/ui/zen/base/ZenButton";
```

**Tema:** Dark mode zinc con acentos por rol (emerald/blue/purple)

---

## üîß C√ìDIGO

**TypeScript:**

- Strict mode SIEMPRE
- NO `any` (usar `unknown`)
- Tipar props y retornos
- `interface` sobre `type`

**React:**

- Componentes funcionales
- `"use client"` solo si necesario
- Server Components por defecto

**Next.js:**

- Server Actions para mutaciones
- API Routes SOLO webhooks

---

## üóÑÔ∏è BASE DE DATOS

**Naming (CR√çTICO):**

- Tablas: `snake_case` plural (`studio_modules`)
- Columnas: `snake_case` (`is_active`, `created_at`)
- Relaciones: `{tabla}_id` (`studio_id`)

**Prisma:**

```prisma
model studio_modules {
  id         String   @id @default(cuid())
  studio_id  String
  is_active  Boolean  @default(false)
  created_at DateTime @default(now())

  @@unique([studio_id, module_id])
  @@index([studio_id, is_active])
}
```

---

## üìù CONVENCIONES

**Naming:**

- Archivos: `kebab-case.tsx`
- Componentes: `PascalCase`
- Variables: `camelCase`
- Constantes: `UPPER_SNAKE_CASE`
- Server Actions: `verbSustantivo` (`crearLead`)

**Imports (Orden):**

```typescript
// 1. React/Next
// 2. Third-party
// 3. ZEN Design System
// 4. Shadcn (fallback)
// 5. Local (types ‚Üí utils ‚Üí components)
```

---

## üö® PROHIBIDO

- ‚ùå Usar `any`
- ‚ùå Usar Shadcn si existe componente ZEN
- ‚ùå Queries Prisma en Client Components
- ‚ùå Hardcodear strings repetidos
- ‚ùå **Res√∫menes m√∫ltiples innecesarios**
- ‚ùå **Explicar c√≥digo autoexplicativo**

---

## ‚úÖ SIEMPRE HACER

- ‚úÖ ZEN Design System primero
- ‚úÖ Tipado fuerte TypeScript
- ‚úÖ Error handling + loading states
- ‚úÖ Validaci√≥n Zod en Server Actions
- ‚úÖ Verificar permisos de m√≥dulo
- ‚úÖ **Respuestas concisas y directas**
- ‚úÖ **C√≥digo > Palabras**

---

## üéØ PATRONES R√ÅPIDOS

**Server Action:**

```typescript
"use server";
export async function crearLead(studioId: string, data: unknown) {
  const hasModule = await checkStudioModule(studioId, "manager");
  if (!hasModule) throw new Error("M√≥dulo no activo");

  const validated = LeadCreateSchema.parse(data);
  const lead = await prisma.platform_leads.create({ data: validated });

  revalidatePath(`/studio/${slug}/manager/kanban`);
  return lead;
}
```

**Formulario ZEN:**

```typescript
<form onSubmit={handleSubmit}>
  <ZenInput label="Nombre" name="nombre" required error={errors.nombre} />
  <ZenButton type="submit" loading={isSubmitting}>Guardar</ZenButton>
</form>
```

---

## üì¶ DEPENDENCIAS

- Next.js 15.5.2
- React 19.1.0
- TypeScript 5
- Prisma 6.15.0
- Supabase 2.57.4
- Tailwind 4

---

## ü§ñ DIVISI√ìN DE MODELOS

**Sonnet 4.5:** Arquitectura, refactoring complejo, code review cr√≠tico  
**Haiku 4.5:** CRUD, componentes UI, queries, debugging (90% del trabajo)  
**Claude Code:** Migraciones, scripts

---

**Prioriza eficiencia en tokens sin sacrificar calidad.**  
**C√≥digo limpio, respuestas directas, fot√≥grafo mobile-first.**
